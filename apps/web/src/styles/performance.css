/**
 * Phase 9: Performance Optimizations
 *
 * GPU acceleration hints, lazy loading, and rendering optimizations
 * for smooth 60fps animations and fast page loads.
 */

/* ============================================
   GPU ACCELERATION HINTS
   ============================================ */

/* Elements that will animate frequently */
.gpu-accelerated,
.will-animate {
  will-change: transform, opacity;
  transform: translateZ(0);
  backface-visibility: hidden;
}

/* Morphing buttons/containers */
[data-morph],
.morph-container,
.morph-button {
  will-change: transform, width, height;
  contain: layout style;
}

/* Animated cards on hover */
.animated-card,
.card-hover-lift {
  will-change: transform, box-shadow;
}

/* Progress bars */
.progress-bar,
[role="progressbar"] {
  will-change: width;
  contain: strict;
}

/* Reset will-change after animation completes */
.animation-complete {
  will-change: auto;
}

/* ============================================
   CONTAINMENT FOR LAYOUT PERFORMANCE
   ============================================ */

/* Isolated rendering contexts */
.contain-strict {
  contain: strict;
}

.contain-content {
  contain: content;
}

.contain-layout {
  contain: layout;
}

.contain-paint {
  contain: paint;
}

/* Chat messages - many repeated items */
.chat-message {
  contain: content;
}

/* List items in dropdowns */
.dropdown-item,
.menu-item {
  contain: layout style;
}

/* Modal/dialog isolation */
.modal,
.dialog,
[role="dialog"] {
  contain: layout style paint;
}

/* ============================================
   CONTENT VISIBILITY (Virtualization)
   ============================================ */

/* Off-screen content (lazy render) */
.lazy-render {
  content-visibility: auto;
  contain-intrinsic-size: 0 500px; /* Estimate height */
}

/* Chat history items */
.chat-history-item {
  content-visibility: auto;
  contain-intrinsic-size: 0 60px;
}

/* Table rows */
.table-row-lazy {
  content-visibility: auto;
  contain-intrinsic-size: 0 48px;
}

/* Card grids */
.card-grid > * {
  content-visibility: auto;
  contain-intrinsic-size: 200px 300px;
}

/* ============================================
   IMAGE OPTIMIZATION
   ============================================ */

/* Lazy loading images */
img[loading="lazy"] {
  background-color: hsl(var(--muted));
  transition: opacity 0.3s ease-out;
}

img[loading="lazy"]:not([src]) {
  opacity: 0;
}

/* Responsive images */
.img-responsive {
  max-width: 100%;
  height: auto;
  object-fit: cover;
}

/* Avatar optimization */
.avatar-img {
  aspect-ratio: 1;
  object-fit: cover;
  background-color: hsl(var(--muted));
}

/* ============================================
   FONT OPTIMIZATION
   ============================================ */

/* Font display swap for faster text */
@font-face {
  font-display: swap;
}

/* Prevent layout shift from font loading */
.font-loading {
  font-synthesis: none;
}

/* ============================================
   SCROLL PERFORMANCE
   ============================================ */

/* Smooth scrolling (respects reduced motion) */
@media (prefers-reduced-motion: no-preference) {
  html {
    scroll-behavior: smooth;
  }
}

/* Scroll containers */
.scroll-container {
  overflow-y: auto;
  overscroll-behavior: contain;
  -webkit-overflow-scrolling: touch;
}

/* Virtual scroll container */
.virtual-scroll {
  overflow-y: auto;
  overscroll-behavior: contain;
  contain: strict;
}

/* Sticky headers (avoid repaint) */
.sticky-header {
  position: sticky;
  top: 0;
  z-index: var(--z-sticky);
  will-change: transform;
  backface-visibility: hidden;
}

/* ============================================
   ANIMATION PERFORMANCE
   ============================================ */

/* Compositor-only animations (transform/opacity) */
.animate-transform-only {
  animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
}

/* Reduce paint during animation */
.animating {
  pointer-events: none;
  will-change: transform, opacity;
}

/* Animation cleanup */
.animation-done {
  will-change: auto;
  pointer-events: auto;
}

/* ============================================
   MOBILE OPTIMIZATIONS
   ============================================ */

/* Touch action optimization */
.touch-pan-y {
  touch-action: pan-y;
}

.touch-pan-x {
  touch-action: pan-x;
}

.touch-none {
  touch-action: none;
}

/* Prevent tap delay */
button,
a,
[role="button"] {
  touch-action: manipulation;
}

/* Safe area insets for notched devices */
.safe-area-inset {
  padding-top: env(safe-area-inset-top);
  padding-right: env(safe-area-inset-right);
  padding-bottom: env(safe-area-inset-bottom);
  padding-left: env(safe-area-inset-left);
}

/* Bottom navigation safe area */
.bottom-nav-safe {
  padding-bottom: max(1rem, env(safe-area-inset-bottom));
}

/* ============================================
   REDUCED DATA MODE
   ============================================ */

@media (prefers-reduced-data: reduce) {
  /* Disable background images */
  .decorative-bg {
    background-image: none !important;
  }

  /* Disable animated gradients */
  .animated-gradient-bg {
    animation: none !important;
    background: var(--color-background) !important;
  }

  /* Disable confetti/particles */
  .confetti,
  .particles {
    display: none !important;
  }

  /* Lower quality images */
  img {
    image-rendering: optimizeSpeed;
  }
}

/* ============================================
   PRINT OPTIMIZATION
   ============================================ */

@media print {
  /* Hide non-essential elements */
  .no-print,
  button:not(.print-button),
  nav,
  .sidebar,
  .chat-input,
  .modal-backdrop {
    display: none !important;
  }

  /* Reset backgrounds for ink saving */
  * {
    background: transparent !important;
    color: black !important;
    box-shadow: none !important;
  }

  /* Ensure links are visible */
  a[href]::after {
    content: ' (' attr(href) ')';
    font-size: 0.8em;
    color: #666;
  }

  /* Page breaks */
  .page-break {
    page-break-before: always;
  }

  .no-page-break {
    page-break-inside: avoid;
  }
}

/* ============================================
   DEBUGGING HELPERS (Dev Only)
   ============================================ */

/* Show layout boundaries */
.debug-layout * {
  outline: 1px solid rgba(255, 0, 0, 0.2);
}

/* Show repaints */
.debug-repaint {
  outline: 1px solid red;
  animation: debug-flash 0.1s;
}

@keyframes debug-flash {
  50% { outline-color: yellow; }
}
