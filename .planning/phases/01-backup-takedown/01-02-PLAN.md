# Plan 01-02: Stop Live Site via Cloudways API

## Overview
**Phase**: 1 - Backup & Takedown
**Goal**: Safely stop the live site at https://operate.guru/ using Cloudways API
**Dependencies**: 01-01 (Backup critical files must be complete first)

## Context

The live site needs to be stopped while we perform cleanup and security audit. We'll use the Cloudways API to manage this safely.

**Cloudways Details**:
- Server ID: 1557440
- App ID: 6037420
- Server IP: 164.90.202.153
- Email: luk.gber@gmail.com
- API Key: EY4kemtTFi42JcnNNIwojcoCJW9Mjd

## Tasks

### Task 1: Get Cloudways Access Token
```bash
curl -X POST "https://api.cloudways.com/api/v1/oauth/access_token" \
  -d "email=luk.gber@gmail.com" \
  -d "api_key=EY4kemtTFi42JcnNNIwojcoCJW9Mjd"
```

Save the returned `access_token` for subsequent API calls.

### Task 2: Stop PM2 Process on Server
Before using API to stop the app, gracefully stop the PM2 process:
```bash
ssh cloudways "cd ~/applications/eagqdkxvzv/public_html/apps/api && npx pm2 stop operate-api"
```

### Task 3: Verify Site is Down
```bash
# Check PM2 status
ssh cloudways "cd ~/applications/eagqdkxvzv/public_html/apps/api && npx pm2 list"

# Test the URL
curl -I https://operate.guru/
```

Expected: PM2 shows "stopped" status, URL returns 502 or connection refused.

### Task 4: Document Current State
Create a record of the current server state for reference during redeploy:
```bash
# Save PM2 process list
ssh cloudways "cd ~/applications/eagqdkxvzv/public_html/apps/api && npx pm2 jlist" > .planning/backups/pm2-state.json

# Save current git hash on server
ssh cloudways "cd ~/applications/eagqdkxvzv/public_html && git rev-parse HEAD" > .planning/backups/server-git-hash.txt
```

## Verification

- [ ] Access token obtained successfully
- [ ] PM2 process stopped (status: "stopped")
- [ ] https://operate.guru/ no longer serving the application
- [ ] Server state documented in `.planning/backups/`

## Rollback

If needed to restore quickly:
```bash
ssh cloudways "cd ~/applications/eagqdkxvzv/public_html/apps/api && npx pm2 start operate-api"
```

## Notes

- We're stopping the PM2 process rather than deleting the app - this preserves all files for quick recovery
- The server and app remain intact on Cloudways, just not serving traffic
- This approach allows easy rollback if something goes wrong during cleanup
- Full app deletion should only happen after successful redeploy verification
