# Phase 01: Performance Optimization - Dashboard, Chat, Tax

## Objective
Optimize load times for Dashboard, Chat, and Tax pages through lazy loading, code splitting, and parallel data fetching.

## Context
These pages currently load content in 1.3-4s but trigger `networkidle2` timeouts due to:
- SSE connections (notifications, suggestions)
- Multiple sequential API calls
- Heavy library bundles (Recharts ~45KB, Framer Motion ~100KB, GSAP)

React.memo optimizations already applied. This plan adds architectural optimizations.

## Tasks

### Task 1: Dashboard - Lazy Load Charts
**Type:** frontend
**Files:**
- `apps/web/src/app/(dashboard)/dashboard/page.tsx`
- `apps/web/src/components/dashboard/RevenueChart.tsx`
- `apps/web/src/components/dashboard/CashFlowChartWidget.tsx`
- `apps/web/src/components/dashboard/ExpenseBreakdown.tsx`

**Action:**
1. Wrap chart components with `dynamic()` from next/dynamic with `ssr: false`
2. Add loading skeletons for deferred components
3. Use `Suspense` boundaries around chart sections

**Pattern:**
```tsx
import dynamic from 'next/dynamic';
import { Skeleton } from '@/components/ui/skeleton';

const RevenueChart = dynamic(
  () => import('@/components/dashboard/RevenueChart').then(m => ({ default: m.RevenueChart })),
  {
    ssr: false,
    loading: () => <Skeleton className="h-[300px] w-full" />
  }
);
```

**Verify:** Dashboard loads skeleton immediately, charts load after
**Done:** Charts lazy loaded, initial bundle reduced

---

### Task 2: Chat - Defer Insight Card Data
**Type:** frontend
**Files:**
- `apps/web/src/app/(dashboard)/chat/page.tsx`
- `apps/web/src/components/chat/InsightsWidget.tsx`
- `apps/web/src/hooks/useAIInsights.ts`

**Action:**
1. Make insight data fetching opt-in (don't fetch on mount)
2. Add `enabled: false` to insight queries initially
3. Trigger fetch only when insights panel is opened/visible
4. Use Intersection Observer to load when scrolled into view

**Pattern:**
```tsx
const { data: insights } = useQuery({
  queryKey: ['insights'],
  queryFn: fetchInsights,
  enabled: isInsightsPanelVisible, // Don't fetch until needed
});
```

**Verify:** Chat page loads without waiting for insights API
**Done:** Insight queries deferred until needed

---

### Task 3: Tax - Parallel API Calls
**Type:** frontend
**Files:**
- `apps/web/src/app/(dashboard)/tax/page.tsx`
- `apps/web/src/hooks/use-tax-reports.ts`
- `apps/web/src/hooks/use-deductions.ts`

**Action:**
1. Use `useQueries` or Promise.all for parallel fetching
2. Remove sequential dependencies between tax hooks
3. Add independent loading states per section

**Pattern:**
```tsx
// Instead of sequential:
const { data: taxReport } = useTaxReport();
const { data: deductions } = useDeductions(); // waits for above

// Use parallel:
const results = useQueries({
  queries: [
    { queryKey: ['taxReport'], queryFn: fetchTaxReport },
    { queryKey: ['deductions'], queryFn: fetchDeductions },
  ]
});
```

**Verify:** Network tab shows parallel requests, not waterfall
**Done:** Tax data loads in parallel

---

## Verification
1. Run Lighthouse on each page - LCP should be under 2.5s
2. Check Network tab - no waterfall patterns
3. Bundle analyzer shows reduced initial JS

## Success Criteria
- [ ] Dashboard initial JS bundle reduced by ~50KB (deferred charts)
- [ ] Chat loads without insight API calls blocking render
- [ ] Tax page makes parallel API requests
- [ ] All 3 pages pass browser test with 10s timeout

## Output
Create `01-01-SUMMARY.md` with:
- Bundle size before/after
- Load time measurements
- Any deviations from plan
