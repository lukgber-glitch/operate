// ============================================================================
// CONVERSATION MEMORY - Add these models to schema.prisma after MessageActionLog
// ============================================================================

enum MemoryType {
  PREFERENCE
  FACT
  INSTRUCTION
  CONTEXT
}

/// Stores important memories extracted from conversations
model ConversationMemory {
  id             String     @id @default(uuid())
  userId         String
  organizationId String
  type           MemoryType
  content        String     @db.Text
  confidence     Float      @default(1.0)
  source         String     @default("extracted") // extracted, user, system
  conversationId String?    // Optional, for conversation-specific memories
  metadata       Json?

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  expiresAt DateTime? // Optional expiration date

  // Relations
  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  organisation Organisation @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([organizationId])
  @@index([type])
  @@index([conversationId])
  @@index([expiresAt])
  @@map("conversation_memories")
}

/// Stores summaries of old conversation messages
model ConversationSummary {
  id               String   @id @default(uuid())
  conversationId   String   @unique
  summary          String   @db.Text
  messagesIncluded Int // Number of messages summarized
  tokensUsed       Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@map("conversation_summaries")
}

// ============================================================================
// INSTRUCTIONS:
// 1. Copy the enum and models above
// 2. Insert them into schema.prisma after the MessageActionLog model (around line 2763)
// 3. Run: npx prisma format
// 4. Run: npx prisma migrate dev --name add-conversation-memory
// ============================================================================
